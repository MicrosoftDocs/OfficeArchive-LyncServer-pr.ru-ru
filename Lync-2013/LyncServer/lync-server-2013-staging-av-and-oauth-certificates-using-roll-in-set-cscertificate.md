---
title: Промежуточное хранение и сертификаты OAuth с использованием Set-CsCertificate
description: Выведите на экран набор сертификатов AV и OAuth с помощью Set-CsCertificate.
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Staging AV and OAuth certificates using -Roll in Set-CsCertificate
ms:assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ660292(v=OCS.15)
ms:contentKeyID: 49354387
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 3732c4adb4327cc1e4111307ab2d72ed080cf221
ms.sourcegitcommit: 36fee89bb887bea4f18b19f17a8c69daf5bc423d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "49423779"
---
# <a name="staging-av-and-oauth-certificates-in-lync-server-2013-using--roll-in-set-cscertificate"></a>Промежуточное хранение и сертификаты OAuth в Lync Server 2013 с помощью Set-CsCertificate

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2012-11-13_

Аудио-и видеосвязь (A/V) — это ключевой компонент Microsoft Lync Server 2013. Такие функции, как общий доступ к приложениям, а также аудио-и видеоконференции, основываются на сертификатах, назначенных службе EDGE (a/V), а именно службе проверки подлинности.

<div>


> [!IMPORTANT]
> <OL>
> <LI>
> <P>Эта новая функция разработана для работы со службой EDGE (A/V) и сертификатом <EM>OAuthTokenIssuer</EM> . Другие типы сертификатов могут быть предоставлены вместе со службой EDGE (A/V) и типом сертификата OAuth, но это не выгодно из-за сосуществования сертификата службы Edge.</P>
> <LI>
> <P>Командлеты PowerShell среды управления сервером Lync Server, используемые для управления сертификатами Microsoft Lync Server 2013, относятся к сертификату службы EDGE в качестве типа сертификата <EM>AudioVideoAuthentication</EM> и сертификата OAuthServer в качестве типа <EM>OAuthTokenIssuer</EM>. В оставшейся части этого раздела и однозначном определении сертификатов они будут обращаться к одному и тому же идентификатору, <EM>AudioVideoAuthentication</EM> и <EM>OAuthTokenIssuer</EM>.</P></LI></OL>



</div>

Служба проверки подлинности A/V отвечает за выдачу маркеров, используемых клиентами и другими пользователями/V. Маркеры генерируются из атрибутов сертификата, и при истечении срока действия сертификата теряется соединение и требование для повторного присоединения с новым маркером, созданным новым сертификатом. Новая функция в Lync Server 2013 поможет решить эту проблему — возможность размещения нового сертификата в начале срока действия старого, и предоставление обоих сертификатов для продолжения работы в течение определенного периода времени. Эта функция использует обновленные функции в командлете Set-CsCertificate Lync Server Management Shell. Новый параметр — рулон с существующим параметром — EffectiveDate будет размещать новый сертификат AudioVideoAuthentication в хранилище сертификатов. Старый сертификат AudioVideoAuthentication останется для проверки выпущенных маркеров. Начиная с размещения нового сертификата AudioVideoAuthentication, произойдет следующая серия событий:

<div>


> [!TIP]
> С помощью командлетов командной консоли Lync Server для управления сертификатами вы можете запросить отдельные и разные сертификаты для каждой цели на пограничном сервере. Использование мастера сертификатов в мастере развертывания Lync Server помогает создавать сертификаты, но обычно имеет тип <STRONG>по умолчанию</STRONG> , который прикрепляет все сертификаты для пограничного сервера к одному сертификату. Если вы собираетесь использовать функцию межсертификатного сертификата, рекомендуется отключать сертификат AudioVideoAuthentication из других целей сертификата. Вы можете подготавливать сертификат по умолчанию и пополнить его, но только часть AudioVideoAuthentication комбинированного сертификата будет полезна при выуровне. Если при истечении срока действия сертификата пользователь приходил к разговору (например), вам потребуется выйти из системы и снова войти в систему, чтобы использовать новый сертификат, связанный с службой Edge Access. Аналогичное поведение может возникнуть для пользователя, участвующего в веб-конференции с помощью службы Edge для веб-конференций. Сертификат OAuthTokenIssuer — это конкретный тип, который является общим для всех серверов. Вы создаете сертификат и управляете им в одном расположении, и сертификат хранится в хранилище Центрального управления для всех остальных серверов.



</div>

Дополнительные сведения необходимы для полного понимания параметров и требований при использовании командлета Set-CsCertificate и его использования для размещения сертификатов до истечения срока действия текущего сертификата. Параметр-рулон важен, но фактически является единственной целью. Если вы задаете его в качестве параметра, вы указываете Set-CsCertificate, что вы будете предоставлять сведения о сертификате, который будет зависеть от-Type (например, AudioVideoAuthentication и OAuthTokenIssuer), когда сертификат станет эффективнее, определяемым на – EffectiveDate.

**-Сведение:** Параметр – рулон является обязательным и имеет зависимости, которые должны быть предоставлены вместе с ним. Обязательные параметры, позволяющие полностью определить, какие сертификаты будут затронуты и как они будут применены.

**-EffectiveDate:** Параметр — EffectiveDate определяет, когда новый сертификат становится совместен с текущим сертификатом. Приложение – EffectiveDate может быть близко к сроку действия текущего сертификата или может быть больше времени. Рекомендуемый минимум — EffectiveDate для сертификата AudioVideoAuthentication — это 8 часов, который является временем жизни токенов, выпущенных по умолчанию для маркеров служебной программы ребра EDGE, выданных с помощью сертификата AudioVideoAuthentication.

При использовании промежуточных сертификатов OAuthTokenIssuer для времени опережения могут быть разные требования, прежде чем сертификат станет эффективнее. Минимальное время, в течение которого должен быть сертификат OAuthTokenIssuer для своего периода ожидания, составляет 24 часа до окончания срока действия текущего сертификата. Расширенное время упреждения для сосуществования связано с тем, что в связи с другими ролями сервера, которые зависят от сертификата OAuthTokenIssuer (например, Exchange Server), которое имеет более длительное время хранения для сертификата, созданного для проверки подлинности и ключа шифрования.

**-Отпечаток:** Отпечаток — это атрибут сертификата, уникальный для этого сертификата. Параметр – Thumbprint используется для идентификации сертификата, который повлияет на действия, выполняемые командлетом Set-CsCertificate.

**-Type (тип):** Параметр – Type может использовать один тип использования сертификата или список типов использования сертификатов с разделителями-запятыми. Типы сертификатов — это те, которые определяют для командлета и сервера назначение сертификата. Например, введите AudioVideoAuthentication для использования службой Edge/V и службой проверки подлинности AV. Если вы решите поэтапное резервное рабочее время и выложить сертификаты другого типа, вы должны оценить максимально необходимое минимальное количество времени упреждения для сертификатов. Например, необходимо выполнить поэтапную настройку сертификатов типа AudioVideoAuthentication и OAuthTokenIssuer. Минимальное значение – EffectiveDate должно быть большим из двух сертификатов, в этом случае OAuthTokenIssuer, в котором минимальное время упреждения — 24 часа. Если вы не хотите пополнить сертификат AudioVideoAuthentication с временем опережения в 24 часа, поэтапировать его отдельно с помощью EffectiveDate, который больше ваших требований.

<div>

## <a name="to-update-or-renew-an-av-edge-service-certificate-with-a-roll-and--effectivedate-parameters"></a>Обновление и возобновление сертификата службы EDGE (A/V) с помощью параметров – рулон и-EffectiveDate

1.  Войдите на локальный компьютер как член группы "Администраторы".

2.  Запрос возобновления или нового сертификата AudioVideoAuthentication с экспортируемым закрытым ключом для существующего сертификата в службе EDGE (A/V).

3.  Импортируйте новый сертификат AudioVideoAuthentication на пограничный сервер и весь другой пограничный сервер в пуле (если у вас есть пул).

4.  Настройте импортированный сертификат с помощью командлета Set-CsCertificate и используйте параметр – рулон с параметром – EffectiveDate. Дата вступления в силу должна быть задана в качестве срока действия текущего сертификата (14:00:00 или 2:00:00) минус время жизни токена (по умолчанию восемь часов). Это дает нам время, в течение которого сертификат должен быть активным, а именно – EffectiveDate \<string\> : "7/22/2012 6:00:00 AM".
    
    <div>
    

    > [!IMPORTANT]
    > Для пула пограничного сервера необходимо, чтобы все сертификаты AudioVideoAuthentication развернутые и выводились с помощью даты и времени первого развернутого сертификата, чтобы избежать возможного нарушения обмена данными из-за того, что истек срок действия более ранней версии сертификата, после того как все маркеры клиента и потребителя будут обновлены с помощью нового сертификата.

    
    </div>
    
    Команда Set-CsCertificate с параметром – рулон и – EffectiveTime:
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    Пример Set-CsCertificate команды:
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2012 6:00:00 AM"
    
    <div>
    

    > [!IMPORTANT]
    > EffectiveDate должен быть отформатирован в соответствии с регионом сервера и языковыми параметрами. В примере используются языковые параметры США и Language.

    
    </div>

Чтобы еще лучше понять процесс, который задается с помощью функции Set-CsCertificate,-рулон и – EffectiveDate, используется для создания нового сертификата для выпуска новых маркеров AudioVideoAuthentication и по-прежнему использовать существующий сертификат для проверки AudioVideoAuthentication, используемых потребителями, визуальная временная шкала является эффективным средством понимания процесса.

В приведенном ниже примере администратор определяет, что срок действия сертификата службы EDGE (A/V) истек в 2:00:00 PM на 07/22/2012. Он запрашивает и получает новый сертификат и импортирует его на каждый пограничный сервер в его пуле. В 07/22/2012 начинается выполнение Get-CsCertificate с параметром – рулон,-Thumbprint, равным строке отпечатка нового сертификата, а для параметра – EffectiveTime — 07/22/2012 6:00:00 AM. Он запускает эту команду на каждом пограничном сервере.

![Использование параметров Roll и EffectiveDate.](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "Использование параметров Roll и EffectiveDate.")

По истечении срока действия (7/22/2012 6:00:00 AM) все новые маркеры выдаются новым сертификатом. При проверке маркеров сначала проверяются маркеры для нового сертификата. Если проверка завершится ошибкой, будет произведена попытка использования старого сертификата. Процесс попытки нового и прекращения работы старого сертификата будет продолжаться до тех пор, пока не истечет срок действия старого сертификата. После истечения срока действия старого сертификата (7/22/2012 2:00:00 PM) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью командлета Remove-CsCertificate с параметром – Previous.

    Remove-CsCertificate -Type AudioVideoAuthentication -Previous

</div>

<div>

## <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a-roll-and--effectivedate-parameters"></a>Обновление сертификата OAuthTokenIssuer с помощью параметров – рулон и EffectiveDate

1.  Войдите на локальный компьютер как член группы "Администраторы".

2.  Запрос возобновления или нового сертификата OAuthTokenIssuer с экспортируемым закрытым ключом для существующего сертификата в службе EDGE (A/V).

3.  Импортируйте новый сертификат OAuthTokenIssuer на сервер переднего плана в пуле (если у вас развернут пул). Сертификат OAuthTokenIssuer реплицируется глобально и нуждается в обновлении и обновлении на любом сервере в развертывании. В качестве примера используется сервер переднего плана.

4.  Настройте импортированный сертификат с помощью командлета Set-CsCertificate и используйте параметр – рулон с параметром – EffectiveDate. Дата вступления в силу должна быть указана как срок действия текущего сертификата (14:00:00 или 2:00:00), но не менее 24 часов.
    
    Команда Set-CsCertificate с параметром – рулон и – EffectiveTime:
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    Пример Set-CsCertificate команды:
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2012 1:00:00 PM"
    
    <div>
    

    > [!IMPORTANT]
    > EffectiveDate должен быть отформатирован в соответствии с регионом сервера и языковыми параметрами. В примере используются языковые параметры США и Language.

    
    </div>

По истечении срока действия (7/21/2012 1:00:00 AM) все новые маркеры выдаются новым сертификатом. При проверке маркеров сначала проверяются маркеры для нового сертификата. Если проверка завершится ошибкой, будет произведена попытка использования старого сертификата. Процесс попытки нового и прекращения работы старого сертификата будет продолжаться до тех пор, пока не истечет срок действия старого сертификата. После истечения срока действия старого сертификата (7/22/2012 2:00:00 PM) маркеры будут проверяться только новым сертификатом. Старый сертификат можно безопасно удалить с помощью командлета Remove-CsCertificate с параметром – Previous.

    Remove-CsCertificate -Type OAuthTokenIssuer -Previous

</div>

<div>

## <a name="see-also"></a>См. также


[Планирование сертификатов пограничного сервера в Lync Server 2013](lync-server-2013-plan-for-edge-server-certificates.md)  
[Управление проверкой подлинности между сервером (OAuth) и приложениями-партнерами в Lync Server 2013](lync-server-2013-managing-server-to-server-authentication-oauth-and-partner-applications.md)  


[Настройка сертификатов пограничного сервера для Lync Server 2013](lync-server-2013-set-up-edge-certificates.md)  
[Set-CsCertificate](https://technet.microsoft.com/library/Gg398518(v=OCS.15))  
[Remove-CsCertificate](https://technet.microsoft.com/library/Gg412895(v=OCS.15))  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

