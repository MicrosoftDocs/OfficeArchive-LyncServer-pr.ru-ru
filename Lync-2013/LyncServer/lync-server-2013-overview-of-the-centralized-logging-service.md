---
title: 'Lync Server 2013: Общие сведения о централизованной службе ведения журнала'
description: 'Lync Server 2013: Общие сведения о централизованной службе ведения журнала.'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Overview of the Centralized Logging Service
ms:assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688145(v=OCS.15)
ms:contentKeyID: 49733746
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: a357063ff80611789981f5e98a69899ea5cd27a9
ms.sourcegitcommit: 36fee89bb887bea4f18b19f17a8c69daf5bc423d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "49445065"
---
# <a name="overview-of-the-centralized-logging-service-in-lync-server-2013"></a>Общие сведения об централизованной службе ведения журналов в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2013-02-22_

Служба централизованного ведения журналов разработана таким образом, чтобы управлять коллекцией данных с помощью широкой или узкой области. Вы можете собирать данные на всех серверах в параллельном развертывании, определять конкретные элементы для трассировки, устанавливать флаги трассировки и возвращать результаты поиска на одном компьютере или агрегате всех данных со всех серверов. Служба централизованного ведения журналов работает на всех серверах в развертывании. Архитектура централизованной службы ведения журналов включает следующие агенты и службы.

  - ClsAgent.exe *агентом службы ведения журналов* является исполняемый файл службы, взаимодействующий с контроллером и принимающий команды, которые контроллер выдает администратор. Агент запускается как служба на каждом компьютере с сервером Lync Server. Когда агент получает команду, она выполняет команду, отправляет сообщения определенным компонентам для трассировки и записывает журналы трассировки на диск. Кроме того, они считывают журналы трассировки для компьютера и отправляют данные трассировки обратно на контроллер по запросу. ClsAgent прослушивает команды на указанных ниже портах: **tcp 50001**, **TCP 50002** и **TCP 50003**.

  - *Централизованное ведение журналов ClsControllerLib.dll контроллером службы*   — это механизм выполнения команд для командной консоли Lync Server и для ClsController.exe. CLSControllerLib.dll отправляет команды "Пуск", "остановить", "Сброс" и "Поиск" в ClsAgent. When search commands are sent, the resulting logs are returned to the ClsControllerLib.dll and aggregated. Контроллер отвечает за отправку команд агенту, получение состояния этих команд и управление данными файла журнала поиска, возвращенных всеми агентами на любом компьютере в области поиска, а также статистическое вычисление данных журнала в осмысленном и упорядоченном выходном наборе. Информация, приведенная в следующих разделах, сосредоточена на использовании командной консоли Lync Server Management Shell. ClsController.exe ограничены подмножеством функций и функций, доступных в командной консоли Lync Server Management Shell. Справку для ClsController.exe можно найти в командной строке, введя `ClsController` ее имя в каталоге C: Program Files, которые представляют собой \\ \\ стандартные файлы \\ Microsoft Lync Server 2013 \\ ClsAgent.

**Взаимодействие ClsController и ClsAgent**

![Связь между CLSController и CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Связь между CLSController и CLSAgent.")

Команды выдаются с помощью интерфейса командной строки Windows Server или консоли управления Lync Server. The commands are executed on the computer you are logged in to and sent to the ClsAgent locally or to the other computers and pools in your deployment.

ClsAgent поддерживает файл индекса всех файлов .CACHE, которые имеются на локальном компьютере. ClsAgent размещает их так, чтобы они равномерно распределялись по томам, определенным параметром CacheFileLocalFolders, и не занимали более 80% места на каждом томе (расположение и процент локального кэша можно настроить с помощью командлета **Set-CsClsConfiguration**). ClsAgent также отвечает за удаление с локального компьютера устаревших кэшированных файлов журнала трассировки событий (файлов ETL). По истечении двухнедельного срока (этот временной интервал настраивается с помощью командлета **Set-CsClsConfiguration**) эти файлы копируются в общую папку и удаляются с локального компьютера. Дополнительные сведения см. в описании командлета [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration). При получении запроса поиска условия поиска используются для выбора набора кэшированных ETL-файлов для выполнения поиска на основании значений из индекса, поддерживаемого агентом.

<div>


> [!NOTE]  
> ClsAgent может выполнять поиск файлов, перемещенных в общую папку с локального компьютера. После перемещения файлов в общую папку ClsAgent не контролирует их устаревание и удаление. Необходимо определить административную задачу для отслеживания размера файлов в общей папке и их удаления или архивации.



</div>

Результирующие файлы журналов можно считывать и анализировать с помощью различных средств, в том числе с помощью **Snooper.exe** и других средств, способных считывать текстовые файлы, таких как **Notepad.exe**. Snooper.exe входит в состав средств отладки Lync Server 2013, и его можно загрузить с веб-сайта [https://go.microsoft.com/fwlink/?LinkId=285257](https://go.microsoft.com/fwlink/?linkid=285257) .

Как и в OCSLogger, Служба централизованного ведения журналов имеет несколько компонентов, которые необходимо отслеживать, и предоставляет параметры для выбора флагов, например TF \_ Component и TF \_ DIAG. Служба централизованного ведения журналов также сохраняет параметры уровня ведения журнала для OCSLogger.

Самое важное преимущество использования командной консоли Lync Server для управления ClsController с помощью командной строки заключается в том, что вы можете настраивать и определять новые сценарии, используя выбранные поставщики, которые предназначены для проблемного пространства, пользовательские флаги и уровни ведения журнала. The scenarios available to ClsController are limited to those that are defined for the executable.

В предыдущих версиях средство OCSLogger.exe позволяло администраторам и сотрудникам технической поддержки собирать файлы трассировки с компьютеров в развертывании. Наряду с преимуществами средство OCSLogger обладало одним существенным недостатком. В заданный момент времени журналы можно было собирать только на одном компьютере. Можно было вести журналы на нескольких компьютерах с помощью отдельных копий OCSLogger, но при этом создавалось несколько журналов, а простого способа объединения результатов не существовало.

Когда пользователь запрашивает поиск журналов, ClsController определяет, на какие компьютеры отправить этот запрос (на основании выбранных сценариев). Контроллер также определяет, нужно ли выполнять поиск в общей папке, в которой находятся сохраненные ETL-файлы. При получении результатов поиска ClsController объединяет их в один упорядоченный по времени набор, который предоставляется пользователю. Пользователи могут сохранять результаты поиска на локальном компьютере для дальнейшего анализа.

При запуске сеанса ведения журнала пользователь указывает сценарии, имеющие отношение к решаемой задаче. В любой момент времени могут выполняться два сценария. Одним из этих сценариев должен быть сценарий AlwaysOn. Как можно понять из названия, этот сценарий должен всегда выполняться в развертывании, собирая сведения о всех компьютерах, пулах и компонентах.

<div>


> [!IMPORTANT]  
> Сценарий AlwaysOn не выполняется в развертывании по умолчанию. Этот сценарий необходимо явно запустить. После запуска он будет выполняться, пока не будет явно остановлен, а состояние выполнения будет сохраняться между перезагрузками компьютеров. Подробнее о запуске и остановке сценариев можно узнать <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">в разделе Использование функции «начало» для централизованной службы ведения журналов для захвата журналов в Lync server 2013</A> и <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">Использование функции "остановить централизованная служба ведения журнала" в Lync Server 2013</A>.



</div>

При возникновении неполадок запустите второй сценарий, связанный с обнаруженной проблемой. Воспроизведите условия возникновения проблемы и остановите ведение журнала для второго сценария. Выполните в журнале поиск данных, связанных с обнаруженной проблемой. При объединении журналов создается файл, содержащий сообщения трассировки со всех компьютеров в области сайта или в глобальной области развертывания. Если поиск возвращает слишком много данных, которые физически невозможно проанализировать (такую ситуацию часто называют отношением "сигнал-шум", в котором значение "шума" слишком велико), выполните другой поиск с более точными параметрами. На этом этапе можно заметить наборы данных, которые позволяют выявить признаки проблемы и сузить круг поиска. В конечном счете, после выполнения нескольких уточненных поисков можно обнаружить данные, имеющие отношение к проблеме, и определить ее причину.

<div>


> [!TIP]  
> При возникновении проблемного сценария в Lync Server Начните с запроса "что вы уже знаете о проблеме?" Если вы количественно оценить количество проблем, вы можете исключить значительную часть рабочих сущностей на Lync Server.<BR>Рассмотрим пример сценария, в котором пользователи не получают актуальные результаты при поиске контактов. Нет ничего в поиске проблем в мультимедийных компонентах, корпоративных голосах, конференц-связи и некоторых других компонентах. Неизвестно только то, где фактически возникла проблема: в клиенте или на стороне сервера? Контакты собираются из Active Directory репликатором пользователей и доставляются клиенту с помощью сервера адресной книги (ABServer). ABServer получает обновления из базы данных RTC (куда их записывает репликатор пользовательских данных) и собирает их в файлы адресной книги, по умолчанию в 1:30. Клиенты Lync Server получают новую адресную книгу в случайном расписании. Так как вы знаете, как работает процесс, вы можете уменьшить Поиск потенциальных причин на проблемы, связанные с данными, собранными из Active Directory репликатором пользователей, ABServer не может получить и создать файлы адресной книги, либо клиенты не загружают файл адресной книги.



</div>

</div>

<span> </span>

</div>

</div>

</div>

