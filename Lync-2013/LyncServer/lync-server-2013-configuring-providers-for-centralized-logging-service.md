---
title: 'Lync Server 2013: Настройка поставщиков для централизованной службы ведения журнала'
description: 'Lync Server 2013: Настройка поставщиков для централизованной службы ведения журнала.'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configuring providers for Centralized Logging Service
ms:assetid: 6a197ecf-b56b-45e0-8e7c-f532ec5164ff
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688082(v=OCS.15)
ms:contentKeyID: 49733678
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 9146865b3856f7956c6ae393ef38614b0fea168e
ms.sourcegitcommit: 36fee89bb887bea4f18b19f17a8c69daf5bc423d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "49432718"
---
# <a name="configuring-providers-for-centralized-logging-service-in-lync-server-2013"></a>Настройка поставщиков для централизованной службы ведения журналов в Lync Server 2013

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Тема последнего изменения:** 2014-03-19_

Концепция и настройка *поставщиков* в централизованной службе ведения журналов – это один из самых важных для вас моментов. *Поставщики* сопоставляются с компонентами роли сервера Lync Server в модели трассировки сервера Lync Server. Поставщик определяет компоненты сервера Lync Server 2013, которые будут отслеживаться, типы сообщений (например, неустранимые, ошибки или предупреждения) для сбора и флаги (например, TF \_ Connection или TF \_ diag). Поставщики — это отслеживаемые компоненты в каждой роли сервера Lync Server. С их помощью можно определить уровень и тип трассировки компонентов (например, S4, SIPStack, IM и Presence). Определенный поставщик используется в сценарии для группировки всех поставщиков в логическую коллекцию, описывающую состояние определенной проблемы.

Для запуска функций централизованной службы ведения журналов с помощью командной консоли Lync Server вы должны быть членом группы безопасности CsAdministrator или CsServerAdministrator (или настраиваемой роли RBAC), содержащей одну из этих двух групп. Чтобы возвратить список всех ролей управления доступом на основе ролей (RBAC), которые назначены этому командлету (включая любые пользовательские роли RBAC, созданные пользователем), выполните следующую команду из командной консоли Lync Server Management Shell или Windows PowerShell.

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Lync Server 2013 cmdlet"}

Например:

    Get-CsAdminRole | Where-Object {$_.Cmdlets -match "Set-CsClsConfiguration"}

Остальная часть данной темы посвящена определению поставщиков, изменению поставщика и компонентов поставщика, упрощающих поиск и устранение неисправностей. Существует два способа вывести централизованные команды службы ведения журнала. Вы можете использовать CLSController.exe, который расположен по умолчанию в папке C: Program Files, которые представляют собой \\ \\ Общие файлы \\ Microsoft Lync Server 2013 \\ CLSAgent. Кроме того, вы можете использовать командную консоль Lync Server для выдаче команды Windows PowerShell. Важное отличие заключается в том, что при использовании CLSController.exe в командной строке есть ограниченный выбор сценариев, в которых поставщики уже определены и не изменяются, но вы можете задать уровень ведения журнала. С помощью Windows PowerShell вы можете определять новых поставщиков в сеансах ведения журнала и получать полный контроль над их созданием, их сбором и уровнем собираемых данных.

<div class="">


> [!IMPORTANT]  
> Как уже упоминалось, поставщики являются очень мощным средством. Однако сценарии имеют большее значение, так как объединяют в себе все данные, необходимые для определения и выполнения трассировок компонентов, представленных поставщиками. Сценарии, которые являются коллекциями поставщиков, можно сравнить с выполнением пакетного файла, содержащего сотни команд, для сбора большого объема данных, что отличается от выполнения сотен команд по одной в командной строке.<BR>Вместо того, чтобы потребовать подробной информации о поставщиках, Служба централизованного ведения журналов предоставляет ряд сценариев, которые уже определены для вас. Предоставленные сценарии покрывают большое количество различных проблем и неполадок, которые могут возникнуть. В редких случаях может понадобиться создать и определить поставщиков и назначить их в сценарии. Настоятельно рекомендуется ознакомиться с каждым предоставленным сценарием, прежде чем создавать новых поставщиков и сценарии. Хотя здесь предоставляются сведения о создании поставщиков, чтобы вы могли ознакомиться с тем, как сценарии используют элементы поставщиков для сбора данных трассировок, сведения о самих поставщиках в настоящее время не предоставлены.



</div>

[Общие сведения о централизованной службе ведения журналов в Lync Server 2013](lync-server-2013-overview-of-the-centralized-logging-service.md), ключевые элементы определения поставщика для использования в сценарии:

  - **Поставщики услуг**   Если вы знакомы с OCSLogger, поставщики — это компоненты, которые вы указываете, чтобы сообщить OCSLogger о том, что ядро трассировки должно собирать журналы. Поставщики — это те же компоненты, а во многих случаях их имя совпадает с компонентами в OCSLogger. Если вы не знакомы с OCSLogger, поставщики — это компоненты, специфичные для серверной роли, из которой Служба централизованного ведения журналов может собирать журналы. В случае централизованной службы ведения журналов CLSAgent — это архитектура централизованной службы ведения журналов, которая выполняет трассировку компонентов, которые вы определили в конфигурации провайдеров.

  - **Уровни ведения журнала**   OCSLogger предоставил возможность выбрать количество уровней детализации для собираемых данных. Эта функция является неотъемлемой частью централизованной службы ведения журналов и сценариев и определяется параметром **Type** . Можно выбрать следующие значения:
    
      - **Все**   Собирает сообщения трассировки типа "неустранимые", "ошибка", "предупреждение" и сведения о журнале для определенного поставщика.
    
      - **Критическая**   ошибка   Собирает только сообщения трассировки, указывающие на сбой определенного поставщика.
    
      - **Ошибка**   Собирает только сообщения трассировки, указывающие на ошибку определенного поставщика, а также неустранимые сообщения.
    
      - **Предупреждение**   Собирает только сообщения трассировки, указывающие на предупреждение для определенного поставщика, а также неустранимые и сообщения об ошибках.
    
      - **Информация**   Собирает только сообщения трассировки, оповещающие об информационном сообщении на определенном поставщике, а также сообщения о неустранимых ошибках, простых ошибках и предупреждениях.
    
      - **Подробный**   Собирает все сообщения трассировки типа "Неустранимая", "ошибка", "предупреждение" и "сведения" для определенного поставщика.

  - **Flags (флаги**   )   OCSLogger предоставил вариант выбора флагов для каждого поставщика, который определил тип данных, которые можно извлечь из файлов трассировки. В зависимости от поставщика можно задать следующие флаги:
    
      - **Tf \_ Подключение**   предоставляет записи журнала, связанные с подключением. Эти журналы включают сведения о подключениях к определенному компоненту. Кроме того, может быть включен большой объем сведений сетевого уровня (то есть для компонентов без концепции подключения).
    
      - **Tf \_ Безопасность**   — это все события и записи журнала, связанные с безопасностью. Например, для SipStack, это события безопасности, такие как ошибки проверки домена и ошибки проверки подлинности и авторизации клиентов.
    
      - **Tf \_ Функция Diag**   предоставляет события диагностики, которые можно использовать для диагностики и устранения неполадок в компоненте. Например, для SipStack это ошибки сертификатов или ошибки/предупреждения, связанные с DNS.
    
      - **Tf \_ Протокол**   предоставляет сообщения протоколов, такие как SIP и Объединенные кодеки кодеков для сообщества.
    
      - **Tf \_ Компонент**   включает ведение журнала для компонентов, указанных в составе поставщиков.
    
      - **All**   Определяет все доступные для поставщиков флаги.

<div>

## <a name="to-review-information-about-existing-centralized-logging-service-scenario-providers"></a>Просмотр сведений о существующих поставщиках сценариев централизованной службы ведения журнала

1.  Запустите командную консоль Lync Server Management Shell: нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Microsoft Lync Server 2013**, а затем — **Командная консоль Lync Server Management Shell**.

2.  Чтобы просмотреть конфигурацию существующих поставщиков, введите следующую команду:
    
        Get-CsClsScenario -Identity <scope and scenario name> 
    
    Например, чтобы просмотреть сведения о глобальном помощнике конференц-связи, введите следующее:
    
        Get-CsClsScenario -Identity "global/CAA"
    
    Команда отображает список поставщиков со связанными флагами, параметрами и компонентами. Если отображаемая информация не является достаточной или список слишком велик для стандартного формата списка Windows PowerShell, вы можете отобразить дополнительные сведения, определив другой метод вывода. Для этого выполните следующую команду:
    
        Get-CsClsScenario -Identity "global/CAA" | Select-Object -ExpandProperty Provider
    
    В выходе этой команды отображается каждый поставщик. Каждая запись состоит из пяти строк: имя поставщика, тип ведения журнала, уровень ведения журнала, флаги, GUID и роль.

</div>

<div>

## <a name="to-define-a-new-centralized-logging-service-scenario-provider"></a>Определение нового поставщика сценария для централизованной службы ведения журнала

1.  Запустите командную консоль Lync Server Management Shell: нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Microsoft Lync Server 2013**, а затем — **Командная консоль Lync Server Management Shell**.

2.  Поставщик сценария состоит из отслеживаемого компонента, используемых флагов и уровня детализации собираемых данных. Это определяется следующей командой:
    
        $<variableName> = New-CsClsProvider -Name <provider component> -Type <log type> -Level <log level detail type> -Flags <provider trace log flags>
    
    Например, определение поставщика трассировки, которое указывает, что нужно собирать с поставщика Lyss и при каком уровне детализации, выглядит следующим образом.
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Info" -Flags "All"

Параметр –Level указывает сбор сообщений типа неустранимая ошибка, ошибка, предупреждение и информация. Все используемые флаги определены для поставщика Lyss и включают TF \_ Connection, TF \_ diag и \_ протокол TF.

После определения переменной $LyssProvider можно использовать ее в командлете **New-CsClsScenario** для сбора трассировок с поставщика Lyss. Чтобы завершить создание и назначение поставщика новому сценарию, введите следующую команду:

    New-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

где $LyssProvider — это переменная, содержащая определенный сценарий, созданный с помощью командлета **New-CsClsProvider**.

</div>

<div>

## <a name="to-change-an-existing-centralized-logging-service-scenario-provider"></a>Изменение существующего поставщика сценариев для централизованной службы ведения журнала

1.  Запустите командную консоль Lync Server Management Shell: нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Microsoft Lync Server 2013**, а затем — **Командная консоль Lync Server Management Shell**.

2.  Чтобы обновить или изменить конфигурацию существующего поставщика, введите следующую команду:
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "TF_Connection, TF_Diag"
    
    Затем обновите сценарий, чтобы назначить поставщика. Введите следующее:
    
        Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider $LyssProvider

Конечный результат выполнения команды — обновление флагов и уровня поставщика назначенного для сайта сценария: Redmond/RedmondLyssInfo. Новый сценарий можно просмотреть с помощью командлета Get-CsClsScenario. Дополнительные сведения см. в разделе [Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Get-CsClsScenario).

<div class="">


> [!WARNING]  
> <STRONG>New-ClsCsProvider</STRONG> не определяет допустимость флагов. Убедитесь, что названия флагов указаны верно (например, TF_DIAG или TF_CONNECTION). Если названия флагов указаны неверно, поставщик не вернет ожидаемые сведения журналов.



</div>

Если необходимо добавить в этот сценарий дополнительных поставщиков, введите следующую команду:

    Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Add=$ABSProvider, $CASProvider, S4Provider}

где каждый поставщик, определенный с помощью директивы Add, уже был определен с помощью процесса **New-CsClsProvider**.

</div>

<div>

## <a name="to-remove-a-scenario-provider"></a>Удаление поставщика сценария

1.  Запустите командную консоль Lync Server Management Shell: нажмите кнопку **Пуск**, выберите **все программы**, а затем — **Microsoft Lync Server 2013**, а затем — **Командная консоль Lync Server Management Shell**.

2.  Приведенные командлеты позволяют обновить существующих поставщиков и создать новых. Чтобы удалить поставщика, необходимо использовать директиву Replace для параметра Provider в командлете **Set-CsClsScenario**. Единственным способом полностью удалить поставщика является замена его на переопределенного поставщика того же типа с тем же именем, что выполняется с помощью директивы Update. Например, наш поставщик LyssProvider определяется с помощью конвейера WPP в качестве типа журнала, Level Set для отладки, а флаги — TF \_ Connection и TF \_ DIAG. Необходимо изменить флаги на All. Чтобы изменить поставщика, выполните следующую команду:
    
        $LyssProvider = New-CsClsProvider -Name "Lyss" -Type "WPP" -Level "Debug" -Flags "All"

     &nbsp;
    
        Set-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo" -Provider @{Replace=$LyssProvider}

3.  Если необходимо полностью удалить сценарий и связанных с ним поставщиков, выполните следующую команду:
    
        Remove-CsClsScenario -Identity <scope and name of scenario>
    
    Например:
    
        Remove-CsClsScenario -Identity "site:Redmond/RedmondLyssInfo"
    
    <div class="">
    

    > [!WARNING]  
    > Командлет <STRONG>Remove-CsClsScenario</STRONG> не запрашивает подтверждения. Сценарий удаляется вместе со всеми назначенными ему поставщиками. Можно повторно создать сценарий, повторно выполнив команды, которые использовались для его исходного создания. Процедуры восстановления удаленных сценариев или поставщиков не существует.

    
    </div>

При удалении сценария с помощью командлета **Remove-CsClsScenario** вы полностью удаляете сценарий из области применения. Чтобы использовать созданные сценарии и поставщиков, которые являются частью сценария, необходимо создать новых поставщиков и назначить их новому сценарию.

</div>

<div>

## <a name="see-also"></a>См. также


[Get-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Get-CsClsScenario)  
[New-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/New-CsClsScenario)  
[Remove-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Remove-CsClsScenario)  
[Set-CsClsScenario](https://docs.microsoft.com/powershell/module/skype/Set-CsClsScenario)  
[New-CsClsProvider](https://docs.microsoft.com/powershell/module/skype/New-CsClsProvider)  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

